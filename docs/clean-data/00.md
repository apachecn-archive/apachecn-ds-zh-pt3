

# 零、前言

|   | “请问，巴贝奇先生，如果你把错误的数字输入机器，正确的答案会出来吗？” |   |
|   | ——*查尔斯·巴贝奇(1864 年)* |

|   | *“垃圾进，垃圾出”* |   |
|   | - *美国国内税收署(1963 年)* |

|   | “没有整洁的数据集。” |   |
|   | - *Josh Sullivan，*财富* (2015)* 博思艾伦副总裁 |

第一台计算机器的发明者查尔斯·巴贝奇在他 1864 年的散文集中回忆道，当时他对“思想混乱”感到目瞪口呆，这种混乱会促使人们假设，尽管输入错误，计算机也能计算出正确答案。又过了 100 年，税务机构开始耐心地解释“垃圾进，垃圾出”，以表达这样一种观点:即使对于全能的收税人来说，计算机处理仍然依赖于其输入的质量。再过 50 年，到 2015 年:一个看似神奇的时代，机器学习、自动更正、预期界面和推荐系统比我自己还了解我。然而，所有这些有用的算法仍然需要高质量的数据，以便首先正确地学习，我们哀叹“没有整洁的数据集”。

这本书是为任何经常处理数据的人而写的，无论是作为数据科学家、数据记者、软件开发人员还是其他人。我们的目标是教授实用的策略，以快速轻松地弥合我们想要的数据和我们拥有的数据之间的差距。我们想要高质量、完美的数据，但现实是，我们的数据往往远远达不到要求。无论我们是否被缺失数据、格式错误的数据、位置错误的数据或数据中的异常所困扰，结果往往是，套用说唱歌手臭名昭著的 B.I.G .的话，“更多的数据，更多的问题”。

在整本书中，我们将把数据清理视为数据科学过程中一个重要的、有价值的步骤:容易改进，从不忽视。我们的目标是重新定义数据清理，使之不再是一项可怕、乏味的任务，我们必须努力完成这项任务才能开始真正的工作。相反，有了一些可靠的程序和工具，我们将会知道，就像在厨房里一样，如果你先洗菜，你的食物会看起来更好，味道更好，对你更好。如果你学习一些适当的刀法，你的肉会更多汁，你的蔬菜会煮得更均匀。就像一个伟大的厨师会有他们最喜欢的刀具和烹饪传统一样，一个伟大的数据科学家会希望在最好的条件下使用最好的数据。

# 这本书涵盖了什么

[第 1 章](ch01.html "Chapter 1. Why Do You Need Clean Data?")，*为什么需要整洁的数据？*通过展示数据清理在整个数据科学过程中的核心作用，激发我们对整洁数据的追求。我们接下来用一个简单的例子来展示一些来自真实数据集的脏数据。我们权衡每个潜在清洁过程的利弊，然后描述如何向他人传达我们的清洁变化。

[第 2 章](ch02.html "Chapter 2. Fundamentals – Formats, Types, and Encodings")，*基础——格式、类型和编码*，设置一些关于文件格式、压缩和数据类型的基础知识，包括缺失和空数据以及字符编码。每一部分都有取自真实世界数据集的例子。这一章很重要，因为我们将在本书的其余部分依靠这些基本概念的知识。

[第 3 章](ch03.html "Chapter 3. Workhorses of Clean Data – Spreadsheets and Text Editors")，*清理数据的主力——电子表格和文本编辑器*，描述了如何从两个常用工具中获得最大的数据清理效用:文本编辑器和电子表格。我们将介绍常见问题的简单解决方案，包括如何使用函数、搜索和替换以及正则表达式来更正和转换数据。在本章的最后，我们将使用这两种工具来测试我们的技能，清理一些关于大学的真实数据。

[第 4 章](ch04.html "Chapter 4. Speaking the Lingua Franca – Data Conversions")，*说通用语——数据转换*，重点是将数据从一种格式转换成另一种格式。这是最重要的数据清理任务之一，手边有各种工具来轻松完成这项任务是很有用的。我们首先一步一步地进行每一种不同的转换，包括在逗号分隔值(CSV)、JSON 和 SQL 等常见格式之间来回转换。为了将我们新的数据转换技能付诸实践，我们完成了一个项目，在这个项目中，我们下载了一个脸书朋友网络，并将其转换为几种不同的格式，以便我们可以可视化它的形状。

[第五章](ch05.html "Chapter 5. Collecting and Cleaning Data from the Web")，*从网络上收集和清理数据*，描述了三种不同的方法来清理 HTML 页面中的数据。本章介绍了三种从带标记的文本中提取数据元素的流行工具，它还为理解除了这里显示的特定工具之外的其他方法提供了概念基础。作为本章的项目，我们构建了一套清理程序来从基于 web 的论坛中提取数据。

[第 6 章](ch06.html "Chapter 6. Cleaning Data in PDF Files")，*清理 PDF 文件中的数据*，介绍了几种方法来应对数据清理者面临的最棘手也是最常见的挑战:提取存储在 Adobe 可移植文档格式(PDF)文件中的数据。我们首先检查完成这项任务的低成本工具，然后我们尝试一些低门槛的工具，最后，我们用 Adobe 非自由软件本身进行实验。一如既往，我们使用真实世界的数据进行实验，这为我们学习解决出现的问题提供了丰富的经验。

[第 7 章](ch07.html "Chapter 7. RDBMS Cleaning Techniques")， *RDBMS 清洗技术*，使用公开可用的 tweets 数据集来演示清洗存储在关系数据库中的数据的多种策略。所示的数据库是 MySQL，但是许多概念，包括基于正则表达式的文本提取和异常检测，也很容易适用于其他存储系统。

[第 8 章](ch08.html "Chapter 8. Best Practices for Sharing Your Clean Data")，*分享你的整洁数据的最佳实践*，描述了一些策略，让你的努力工作尽可能容易地为他人所用。即使你从未打算与他人分享你的数据，本章中的策略也将帮助你在自己的工作中保持有条理，为你将来节省时间。本章介绍了如何创建各种格式的理想数据包，如何记录数据，如何选择并为数据附加许可，以及如何公布数据，以便数据可以继续存在。

[第 9 章](ch09.html "Chapter 9. Stack Overflow Project")，*栈溢出项目*，使用真实世界的数据集指导你完成一个完整的项目。我们首先提出一组可信的问题，我们可以回答这些问题。在回答这组问题时，我们将完成在[第一章](ch01.html "Chapter 1. Why Do You Need Clean Data?")、*中介绍的整个数据科学过程，你为什么需要整洁的数据？*我们将把在前面章节中学到的许多清洁过程付诸实践。此外，由于这个数据集非常大，我们将引入一些新的技术来处理测试数据集的创建。

[第 10 章](ch10.html "Chapter 10. Twitter Project")， *Twitter 项目*，是一个完整的项目，展示了如何执行目前最热门、变化最快的数据收集和清理任务之一:挖掘 Twitter。我们将展示如何在遵守对 Twitter 服务使用的法律限制的同时，找到并收集关于真实世界时事的公开可用 tweets 的现有档案。我们将回答一个关于数据集的简单问题，同时学习如何从 JSON 中清理和提取数据，JSON 是目前 API 可访问的 web 数据中最流行的格式。最后，我们将设计一个简单的数据模型，用于长期存储提取和清理的数据，并展示如何生成一些简单的可视化。



# 这本书你需要什么

要完成本书中的项目，您需要以下工具:

*   网络浏览器、互联网接入和现代操作系统。浏览器和操作系统应该无关紧要，但是访问命令行终端窗口是理想的(例如，OS X 的终端应用程序)。在[第 5 章](ch05.html "Chapter 5. Collecting and Cleaning Data from the Web")、*从网络上收集和清理数据*中，三个活动之一依赖于在 Chrome 浏览器中运行的基于浏览器的实用程序，所以如果你想完成这个活动，请记住这一点。
*   文本编辑器，如 Mac OSX 版的 Text Wrangler 或 Windows 版的 Notepad++。一些集成开发环境(ide，比如 Eclipse)也可以用作文本编辑器，但是它们通常具有许多您不需要的特性。
*   电子表格应用程序，如 Microsoft Excel 或 Google 电子表格。在可能的情况下，提供了可以在这两种工具上工作的通用示例，但是在某些情况下，需要使用其中一种工具。
*   Python 开发环境和安装 Python 库的能力。我推荐 Enthought Canopy Python 环境，这里有:[https://www.enthought.com/products/canopy/](https://www.enthought.com/products/canopy/)。
*   安装并运行 MySQL 5.5+服务器。
*   安装了一个 web 服务器(运行任何服务器软件)和 PHP 5+。
*   MySQL 客户端界面，可以是命令行界面、MySQL Workbench 或 phpMyAdmin(如果您运行了 PHP)。



# 这本书是给谁的

如果你正在读这本书，我猜你可能属于两类人之一。一组是数据科学家，他们已经花了很多时间清理数据，但是你想做得更好。您可能对数据清理的单调乏味感到沮丧，您正在寻找加快清理速度、提高效率的方法，或者只是使用不同的工具来完成工作。在我们的厨房比喻中，你就是那个只需要温习几把刀功的厨师。

另一组由从事数据科学工作的人组成，他们以前从未真正关心过数据清理。但是现在，你开始想，如果你有一个清洁过程，也许你的结果会变得更好。也许古老的格言“垃圾进来，垃圾出去”开始感觉有点太真实了。也许您对与其他人共享您的数据感兴趣，但是您对自己生成的数据集的质量没有信心。通过这本书，你将获得足够的信心，通过学习一些技巧和创造新的习惯，确保一个整洁整洁的数据科学环境。

无论哪种方式，这本书都将帮助你重新定义数据清理，从枯燥的象征变成你的质量、品味、风格和效率的标志。你可能应该有一点编程背景，但你不需要很擅长。与大多数数据科学项目一样，学习和实验的意愿以及健康的好奇心和对细节的敏锐关注都非常重要和重要。



# 习俗

在这本书里，你会发现许多区分不同种类信息的文本样式。下面是这些风格的一些例子和它们的含义的解释。

文本中的码字、数据库表名、文件夹名、文件名、文件扩展名、路径名、虚拟 URL、用户输入和 Twitter 句柄如下所示:“问题是`open()`没有准备好处理 UTF-8 字符。”

代码块设置如下:

```
for tweet in stream:
    encoded_tweet = tweet['text'].encode('ascii','ignore')
    print counter, "-", encoded_tweet[0:10]
    f.write(encoded_tweet)
```

当我们希望将您的注意力吸引到代码块的特定部分时，相关的行或项目以粗体显示:

```
First name,birth date,favorite color,salary
"Sally","1971-09-16","light blue",129000
"Manu","1984-11-03","",159960
"Martin","1978-12-10","",76888
```

任何命令行输入或输出都按如下方式编写:

```
tar cvf fileArchive.tar reallyBigFile.csv anotherBigFile.csv
gzip fileArchive.tar

```

**新术语**和**重要词汇**以粗体显示。你在屏幕上看到的单词，例如在菜单或对话框中看到的，会出现在文本中，如下所示:“按住**选项**键，选择分栏文本。”

### 注意

警告或重要提示出现在这样的框中。

### Tip

提示和技巧是这样出现的。



# 读者反馈

我们随时欢迎读者的反馈。让我们知道你对这本书的看法——你喜欢或不喜欢什么。读者的反馈对我们来说很重要，因为它有助于我们开发出真正让你受益匪浅的图书。

要给我们发送总体反馈，只需发送电子邮件`<[feedback@packtpub.com](mailto:feedback@packtpub.com)>`，并在邮件主题中提及书名。

如果有一个你擅长的主题，并且你有兴趣写一本书或者为一本书投稿，请查看我们在[www.packtpub.com/authors](http://www.packtpub.com/authors)的作者指南。



# 客户支持

既然您已经是 Packt book 的骄傲拥有者，我们有许多东西可以帮助您从购买中获得最大收益。

## 下载这本书的彩色图片

我们还为您提供了一个 PDF 文件，其中包含本书中使用的截图/图表的彩色图像。彩色图像将帮助您更好地理解输出中的变化。你可以从[https://www . packtpub . com/sites/default/files/downloads/Clean _ Data _ graphics . zip](https://www.packtpub.com/sites/default/files/downloads/Clean_Data_Graphics.zip)下载这个文件。

## 勘误表

尽管我们已尽一切努力确保内容的准确性，但错误还是会发生。如果您在我们的某本书中发现了错误——可能是文本或代码中的错误——如果您能向我们报告，我们将不胜感激。这样做，你可以让其他读者免受挫折，并帮助我们改进本书的后续版本。如果您发现任何勘误表，请通过访问[http://www.packtpub.com/submit-errata](http://www.packtpub.com/submit-errata)，选择您的图书，点击**勘误表提交表**链接，并输入您的勘误表的详细信息。一旦您的勘误表得到验证，您的提交将被接受，该勘误表将被上传到我们的网站或添加到该标题的勘误表部分下的任何现有勘误表列表中。

要查看之前提交的勘误表，请前往[https://www.packtpub.com/books/content/support](https://www.packtpub.com/books/content/support)并在搜索栏中输入图书名称。所需信息将出现在**勘误表**部分。

## 盗版

互联网上版权材料的盗版是所有媒体都存在的问题。在 Packt，我们非常重视版权和许可证的保护。如果您在互联网上发现我们作品的任何形式的非法拷贝，请立即向我们提供地址或网站名称，以便我们采取补救措施。

请通过`<[copyright@packtpub.com](mailto:copyright@packtpub.com)>`联系我们，并提供可疑盗版材料的链接。

我们感谢您帮助保护我们的作者，以及我们为您带来有价值内容的能力。

## 问题

如果您对本书的任何方面有问题，可以通过`<[questions@packtpub.com](mailto:questions@packtpub.com)>`联系我们，我们将尽最大努力解决问题。