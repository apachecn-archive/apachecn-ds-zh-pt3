<html lang="en">
<head><title>Working with Large Data Sets</title>
<meta content="text/html; charset=utf-8" http-equiv="content-type"/>
<link href="../css/springer_epub.css" rel="styleSheet" type="text/css"/>
</head>
<body>
 
<!--Begin Abstract--><h1 class="ChapterTitle" lang="en">4.处理大型数据集</h1>

 
<!--End Abstract--><p class="Para" id="Par2">在这一章中，我们将通过显著增加我们收集的数据量，在数据科学实验中向前迈出一步。到目前为止，我们已经处理了十几个数据点，这足以满足我们的需求。但有时相关性(和其他有趣的数据特征)是微妙的，很难发现。我们的数据集越大，我们寻找的答案就越有可能在其中。</p>
<p class="Para" id="Par3">如果我们要收集数百、数千甚至数百万个数据点，我们的工具包中就有一个弱点:一个限制我们可以合理收集多少数据的缺陷。考虑这个问题:如果我们想记录一段时间内的天气情况，比如 24 小时，我们将如何重新设计第<strong class="EmphasisTypeBold ">章</strong> <a href="03.html"> <strong class="EmphasisTypeBold "> 3 </strong> </a>中的实验？</p>
<p class="Para" id="Par4">弱点当然是手里拿着纸和笔的人类，尽职尽责地站在大自然中一整天，每 5 分钟记录一次温度、湿度和压力。</p>
<p class="Para" id="Par5">在本章中，我们将开始通过数字化收集和存储数据来消除数据收集过程中的人为因素。这将允许我们建立大量的温度和压力数据，我们将在第<strong class="EmphasisTypeBold ">章</strong> <a href="05.html"> <strong class="EmphasisTypeBold "> 5 </strong> </a>中分析这些数据的相关性。</p>
<h2 class="Heading">4.1 实验设计</h2>
<p>我们将在本章开始进行的实验是为了研究我们在第<strong class="EmphasisTypeBold ">章</strong> <a href="03.html"> <strong class="EmphasisTypeBold "> 3 </strong> </a>中看到的温度和压力之间的相关性。我们将在 24 小时内记录这些测量值，然后分析数据并量化相关性的强度。虽然这听起来类似于我们在<strong class="EmphasisTypeBold ">章节中所做的</strong> <a href="03.html"> <strong class="EmphasisTypeBold "> 3 </strong> </a> <strong class="EmphasisTypeBold ">，</strong>有两个关键区别:</p>
<ol><li class="ListItem"><p class="Para" id="Par7">我们将收集更多的数据。</p>
 </li>
<li class="ListItem"><p class="Para" id="Par8">我们将使用软件进行数据分析。</p>
 </li>
</ol>

<p>实验分为两章:在这一章中，我们建立并使用一个微比特气象站来收集大量数据；然后在<strong class="EmphasisTypeBold ">章</strong> <a href="05.html"> <strong class="EmphasisTypeBold "> 5 </strong> </a>我们分析那个数据。<strong class="EmphasisTypeBold ">表</strong> <a href="#Tab1"> <strong class="EmphasisTypeBold "> 4-1 </strong> </a>描述了我们将如何着手收集实验所需的数据。</p>
<p>表 4-1</p><p class="SimplePara">练习 4-1 的详细信息</p>


<table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="tcol1 align-left"/>
<col class="tcol2 align-left"/>
</colgroup>
<thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">练习 4-1</p>
</th>
<th style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">温度和大气压有关联吗？</p>
</th>
</tr>
</thead>
<tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">摘要</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">我们将在 24 小时内收集尽可能多的温度和压力数据，然后进行分析。</p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">循序渐进的过程</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">1.为数据采集仪器找到一个合适的位置。确保它有新电池。</p>
<p class="SimplePara">2.将仪器放在选定的位置，并接通电源。它将开始记录数据。</p>
<p class="SimplePara">3.24 小时后，去收集仪器。</p>
<p class="SimplePara">4.从 micro:bit 中提取数据并加载到计算机上。</p>
<p class="SimplePara">5.使用电脑上的软件进行分析。</p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; text-align: left;"><p class="SimplePara">我们将学到什么</p>
</td>
<td style="text-align: left;"><p class="SimplePara">如何在 micro:bit 上使用文件存储。</p>
<p class="SimplePara">如何构建数据文件。</p>
<p class="SimplePara">如何使用电子表格进行数据分析。</p>
<p class="SimplePara">如何量化/测量相关性。</p>
<p class="SimplePara">温度和压力的相关性有多强。</p>
<p class="SimplePara">什么是统计意义。</p>
</td>
</tr>
</tbody>
</table>

<p class="Para" id="Par10">这个实验我们首先需要的是一种在 24 小时内记录数据的方法。</p>

<h2 class="Heading">4.2 使用 micro:bit 作为文件存储设备</h2>
<p class="Para" id="Par11">我们不能指望一个人 24 小时站在一个地方，每隔几分钟就记下温度和压力读数。为了消除这种需要，我们将在数据收集过程中将记录的数据保存到文件中，然后在之后访问该文件。将数据直接保存到文件将使我们能够更有效地构建我们的数据收集过程:我们将打开我们的仪器，让它保持 24 小时，同时测量和记录数据，然后回来拿起它。然后将检索该文件。</p>
<p class="Para" id="Par12">MicroPython 有一个文件系统，允许我们在 micro:bit 上保存文件。在<strong class="EmphasisTypeBold "> MakeCode </strong>上没有类似的选项，所以我们需要在 MicroPython 中为此编写代码。</p>
<p class="Para" id="Par13">使用文件系统的第一步是学习如何将数据写入文件。为此，你只需要一个微型钻头和一个电源。</p>
<p>在<strong class="EmphasisTypeBold ">表</strong> <a href="#Tab2"> <strong class="EmphasisTypeBold "> 4-2 </strong> </a>中列出了用 micro:bit 写入文件的<strong class="EmphasisTypeBold ">自然语言代码</strong>。</p>
<p>表 4-2</p><p class="SimplePara">用于在 micro:bit 上创建和写入文件的自然语言代码</p>


<table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="tcol1 align-left"/>
<col class="tcol2 align-left"/>
<col class="tcol3 align-left"/>
</colgroup>
<thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">步骤</p>
</th>
<th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">描述</p>
</th>
<th style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">笔记</p>
</th>
</tr>
</thead>
<tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">one</p>
</td>
<td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">创建文件。</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">在 micro:bit 存储器上创建一个文件，并为其提供一个名称。</p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Two</p>
</td>
<td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">打开文件进行写入。</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">文件必须“打开”才能使用。</p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">three</p>
</td>
<td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">写入文件。</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">我们将向文件中写入一些任意数据，以便稍后检查我们的代码是否成功。</p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; text-align: left;"><p class="SimplePara">four</p>
</td>
<td style="border-right: 0.5pt solid ; text-align: left;"><p class="SimplePara">关闭文件。</p>
</td>
<td style="text-align: left;"><p class="SimplePara">当我们用完一个文件时，我们应该关闭它。</p>
</td>
</tr>
</tbody>
</table>

<p class="Para" id="Par15"><strong class="EmphasisTypeBold ">无代码选项</strong>:你可以在我们的<strong class="EmphasisTypeBold ">资源网站</strong>上找到本节所需代码的完整工作版本。转到<a href="https://nam12.safelinks.protection.outlook.com/?url%253Dhttp%253A%252F%252Fxib.one%252FXB%2526data%253D02%257C01%257C%257C96ee9c32c458423e9b6a08d7c36cd73f%257C84df9e7fe9f640afb435aaaaaaaaaaaa%257C1%257C0%257C637192744542720716%2526sdata%253D0W1OfWTmIx3U20MIwolvjFvh9lCQJVpw9KNNvUwCdU8%253D%2526reserved%253D0"> <code>http://xib.one/XB</code> </a>并搜索<strong class="EmphasisTypeBold ">第 4.1 节</strong>。</p>
<p><strong class="EmphasisTypeBold ">表</strong> <a href="#Tab3"> <strong class="EmphasisTypeBold "> 4-3 </strong> </a>列出了实现<strong class="EmphasisTypeBold ">表</strong> <a href="#Tab2"> <strong class="EmphasisTypeBold "> 4-2 </strong> </a>中<strong class="EmphasisTypeBold ">自然语言代码</strong>的 MicroPython 代码。</p>
<p>表 4-3</p><p class="SimplePara">写着“你好，世界！”到一个文件中</p>


<table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="tcol1 align-left"/>
<col class="tcol2 align-left"/>
</colgroup>
<thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">步骤</p>
</th>
<th style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">微丝体</p>
</th>
</tr>
</thead>
<tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">1&amp;2</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">键入以下内容，然后按 ENTER 键:</p>
<p class="SimplePara"><code>with open('hello.txt', 'w') as my_file:</code></p>
<p class="SimplePara">这将在 micro:bit 存储器上创建名为<strong class="EmphasisTypeBold "> hello.txt </strong>的文件，然后打开它供您稍后写入。</p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">three</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">键入以下内容，然后按 ENTER 键:</p>
<p class="SimplePara"><code>my_file.write("Hello, World!")</code></p>
<p class="SimplePara">这个会写<strong class="EmphasisTypeBold ">你好，世界！</strong>到文件。</p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; text-align: left;"><p class="SimplePara">four</p>
</td>
<td style="text-align: left;"><p class="SimplePara">文件对我们来说是关闭的——我们不需要为此编写任何代码。</p>
</td>
</tr>
</tbody>
</table>

<p>编写<strong class="EmphasisTypeBold ">“你好，世界！”的完整<strong class="EmphasisTypeBold "> MicroPython </strong>代码</strong>给一个文件是</p>
<pre>with open('hello.txt', 'w') as my_file:
    my_file.write("Hello, World!")

</pre>
<p class="Para" id="Par19">编译代码并将其闪存到您的 micro:bit 上。</p>
<p class="Para" id="Par20">一旦刷新过程完成，micro:bit 复位，一个名为“<strong class="EmphasisTypeBold "> hello.txt </strong>的文件就会创建，其中包含您提供的内容(“hello，World！”).在接下来的部分中，我们将向您展示如何查看和访问该文件。</p>
<p class="Para" id="Par21">我们放在 micro:bit 上的代码基本上告诉它如何作为一个文件存储设备:我们现在可以将任何我们想要的东西写入文件，包括数据，并且我们将能够在以后检索它。</p>
<p class="Para" id="Par22">这一功能提升了 micro:bit 作为数据科学工具的潜力。文件存储使我们能够扩展我们的数据收集能力和进行实验，否则可能是不可能的。在本章中，我们将了解如何将气象站的数据保存到文件中，但是同样的技术也可以用于任意数量的传感器。你的 micro:bit 可以成为监控各种环境测量的数字工具的基础。</p>

<h2 class="Heading">4.3 访问 micro:bit 上的文件</h2>
<p class="Para" id="Par23">一旦你把数据保存到微型钻头上的文件中，下一步就是检索数据并在计算机上使用，在计算机上我们可以使用复杂的分析工具。</p>
<p class="Para" id="Par24">我们可以使用一些工具来列出和访问存储在 micro:bit 上的文件，包括<strong class="EmphasisTypeBold "> Mu </strong>和<strong class="EmphasisTypeBold "> MicroFS </strong>。我们将向您展示如何使用 Mu 来访问我们刚刚编写的文件。</p>
<p><strong class="EmphasisTypeBold ">表</strong> <a href="#Tab4"> <strong class="EmphasisTypeBold "> 4-4 </strong> </a>给出了使用<strong class="EmphasisTypeBold "> Mu </strong>查看 micro:bit 存储器上的文件需要遵循的步骤。</p>
<p>表 4-4</p><p class="SimplePara">用 Mu 列出微位存储器上的文件</p>


<table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="tcol1 align-left"/>
<col class="tcol2 align-left"/>
</colgroup>
<thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">步骤</p>
</th>
<th style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">描述</p>
</th>
</tr>
</thead>
<tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">one</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">使用微型 USB 电缆将 micro:bit 连接到您的计算机。</p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Two</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">在<strong class="EmphasisTypeBold ">管理单元工具栏</strong>上，点击<strong class="EmphasisTypeBold ">文件</strong>按钮。管理单元窗口的底部会出现<strong class="EmphasisTypeBold ">文件</strong>窗格。在<strong class="EmphasisTypeBold ">文件</strong>窗格中的“<strong class="EmphasisTypeBold ">micro:bit</strong>上的文件”下，您将看到 micro:bit 上的文件列表。</p>
<p class="SimplePara"><img alt="../images/486852_1_En_4_Chapter/486852_1_En_4_Figa_HTML.jpg" src="../images/486852_1_En_4_Chapter/486852_1_En_4_Figa_HTML.jpg" style="width:32.5em"/></p>
<p class="SimplePara">您能看到您在上一个练习中创建的文件吗？</p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; text-align: left;"><p class="SimplePara">three</p>
</td>
<td style="text-align: left;"><p class="SimplePara">再次点击<strong class="EmphasisTypeBold ">文件</strong>按钮，关闭<strong class="EmphasisTypeBold ">文件</strong>窗格。</p>
</td>
</tr>
</tbody>
</table>

Caution
<p class="Para FirstParaInFormalPara" id="Par26">当您使用阿木将代码闪存到 micro:bit 时，您的 MicroPython 代码的副本将保存到永久存储区(main.py)。删除这个文件会阻止您的代码运行，您需要刷新 micro:bit。</p>


<h2 class="Heading">4.4 将文件传输到计算机上</h2>
<p>学习如何将数据写入文件的目的是让我们能够使用计算机上可用的一些强大的分析工具。我们只需要先把文件从 micro:bit 上转移到我们的电脑上。这样做的过程在表<a href="#Tab5"> 4-5 </a>中列出。</p>
<p>表 4-5</p><p class="SimplePara">从 Mu 中提取一个文件，然后打开它并查看其内容</p>


<table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="tcol1 align-left"/>
<col class="tcol2 align-left"/>
</colgroup>
<thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">步骤</p>
</th>
<th style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">描述</p>
</th>
</tr>
</thead>
<tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">one</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">在管理部门工具栏上，单击<strong class="EmphasisTypeBold ">文件</strong>。</p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Two</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">将之前创建的<strong class="EmphasisTypeBold "> hello.txt </strong>文件从您微:bit 上的<strong class="EmphasisTypeBold ">文件拖放到您电脑上的<strong class="EmphasisTypeBold ">文件</strong>。</strong></p>
<p class="SimplePara">该文件将从 micro:bit 存储器复制到您计算机的硬盘上，并显示在“<strong class="EmphasisTypeBold "> Files from your computer </strong>”下。</p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">three</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">在“来自你电脑的<strong class="EmphasisTypeBold ">文件</strong>窗格中，右击<strong class="EmphasisTypeBold "> hello.txt </strong>，然后从快捷菜单中点击<strong class="EmphasisTypeBold ">打开</strong>。该文件将使用您的计算机上安装的用于处理文本文件的默认应用程序打开。</p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">four</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">打开文件时检查它，并确认它包含单词“Hello world！”。</p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; text-align: left;"><p class="SimplePara">five</p>
</td>
<td style="text-align: left;"><p class="SimplePara">退出应用程序。</p>
</td>
</tr>
</tbody>
</table>

<p class="Para" id="Par28">你也可以通过你电脑上使用的任何一个<strong class="EmphasisTypeBold ">文件浏览器</strong>来访问这个文件。该文件保存在 Mu 默认保存文件的同一文件夹中。</p>
<p class="Para" id="Par29">我们现在已经向 micro:bit 存储器写入了一个文件，然后提取该文件并在我们的计算机上打开它。我们知道在我们的实验中使用文件系统所需要的一切。</p>

<h2 class="Heading">4.5 硬件要求</h2>
<p>我们的数字仪器将需要包括的元件如图<strong class="EmphasisTypeBold ">图</strong> <a href="#Fig1"> <strong class="EmphasisTypeBold "> 4-1 </strong> </a>所示。</p>
<p><img alt="../images/486852_1_En_4_Chapter/486852_1_En_4_Fig1_HTML.jpg" src="../images/486852_1_En_4_Chapter/486852_1_En_4_Fig1_HTML.jpg" style="width:35.62em"/></p>
<p>图 4-1</p><p class="SimplePara">用于读取天气数据并将其保存到文件中的数字工具</p>


<p><strong class="EmphasisTypeBold ">表</strong> <a href="#Tab6"> <strong class="EmphasisTypeBold "> 4-6 </strong> </a>列出了我们将用来构建气象站工具的具体硬件。</p>
<p>表 4-6</p><p class="SimplePara">气象站工具的硬件要求</p>


<table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="tcol1 align-left"/>
<col class="tcol2 align-left"/>
<col class="tcol3 align-left"/>
<col class="tcol4 align-left"/>
</colgroup>
<thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">你需要什么</p>
</th>
<th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">我们用什么</p>
</th>
<th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">数量</p>
</th>
<th style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">可供选择的事物</p>
</th>
</tr>
</thead>
<tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">一个微处理器和闪存代码的方法</p>
</td>
<td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">微型:带 micro-B USB 电缆的 bit，用于连接笔记本电脑/台式机</p>
</td>
<td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">one</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">树莓派</p>
<p class="SimplePara">赛车场</p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">力量</p>
</td>
<td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">微型钻头电池盒</p>
</td>
<td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">one</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">西诺夫公司太阳能电池</p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">读取天气数据的传感器</p>
</td>
<td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">XinaBox SW01–高级天气传感器</p>
</td>
<td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">one</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">SparkFun Weatherbit</p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">持久记忆</p>
</td>
<td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">微:10 位板载存储器</p>
</td>
<td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">one</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">XinaBox IM01 微型:位桥(SD 卡)</p>
</td>
</tr>
<tr><td rowspan="2" style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">将它们连接在一起的方法</p>
</td>
<td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">XinaBox IM01 微型:位桥</p>
</td>
<td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">one</p>
</td>
<td rowspan="2" style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">试验板、边缘连接器分线点、鳄鱼/鳄鱼线和连接线</p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; text-align: left;"><p class="SimplePara">xBus 连接器</p>
</td>
<td style="border-right: 0.5pt solid ; text-align: left;"><p class="SimplePara">one</p>
</td>
</tr>
</tbody>
</table>


<h2 class="Heading">4.6 将传感器数据存储在文件中</h2>
<p>当我们将数据写入文本文件时，我们可以写任何我们想写的东西:任何我们喜欢的数字或字母。我们可以以纯文本格式存储传感器数据，这种格式易于阅读，例如<strong class="EmphasisTypeBold ">图</strong> <a href="#Fig2"> <strong class="EmphasisTypeBold "> 4-2 </strong> </a>。</p>
<p><img alt="../images/486852_1_En_4_Chapter/486852_1_En_4_Fig2_HTML.jpg" src="../images/486852_1_En_4_Chapter/486852_1_En_4_Fig2_HTML.jpg" style="width:15em"/></p>
<p>图 4-2</p><p class="SimplePara">包含传感器数据的文本文件的屏幕截图</p>


<p class="Para" id="Par33">使用这种方法，很多文件空间会被诸如“温度”、“湿度”、“压力”和“度”这样的词占用:它们有助于使文件可读，但是它们会占用文件中的空间。我们写入文件的每个字符都会“消耗”一些空间，如果 micro:bit 上的内存很紧张(正如我们将看到的那样)，我们就需要丢弃冗余数据。</p>
<p class="Para" id="Par34">我们不得不做出的最困难的决定是不收集湿度数据:谁知道在分析阶段会出现什么有趣的观察结果呢？但是正如您将在接下来的章节中看到的，我们在 micro:bit 上拥有的内存量是非常有限的。我们的实验旨在分析压力和温度之间的关系，所以我们决定忽略湿度，因为它不能帮助我们回答实验的具体目标。微位文件系统上的存储空间是宝贵的，我们保存的每个字符都值得保存。</p>
<p class="Para" id="Par35">图<strong class="EmphasisTypeBold "/><a href="#Fig2"><strong class="EmphasisTypeBold ">4-2</strong></a>中显示的文件的核心问题是，它是我们为这个实验“发明”的定制格式。这是在文件中存储数据的一种不寻常的方式，在无法识别我们创建的格式的软件上打开它会很棘手。我们可以很容易地读懂它，但电脑却很难。</p>
<p class="Para" id="Par36">相反，我们将使用一种经过测试的文件格式:我们将创建一个<strong class="EmphasisTypeBold ">逗号分隔值(</strong>或<strong class="EmphasisTypeBold "> CSV)文件</strong>。以这种格式编写我们的数据将确保我们可以在电子表格程序中打开文件:数据将作为表格自动导入，这对我们的分析将是完美的。</p>
<p>CSV 文件必须遵循许多约定:</p>
<ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par38"><strong class="EmphasisTypeBold ">文件</strong>的每一行都是一个<strong class="EmphasisTypeBold ">记录</strong>。行尾字符表示记录的结束。</p></li>
<li><p class="Para" id="Par39">记录是<strong class="EmphasisTypeBold ">字段</strong>的集合:对我们来说，这意味着每条记录将包括温度和压力值。</p></li>
<li><p class="Para" id="Par40">文件中的每个值都用逗号分隔。</p></li>
</ul>

<p><strong class="EmphasisTypeBold ">图</strong> <a href="#Fig3"> <strong class="EmphasisTypeBold "> 4-3 </strong> </a>显示了与图<strong class="EmphasisTypeBold ">图</strong> <a href="#Fig2"> <strong class="EmphasisTypeBold "> 4-2 </strong> </a>相同的文件，但数据记录以 CSV 格式书写。</p>
<p><img alt="../images/486852_1_En_4_Chapter/486852_1_En_4_Fig3_HTML.jpg" src="../images/486852_1_En_4_Chapter/486852_1_En_4_Fig3_HTML.jpg" style="width:20em"/></p>
<p>图 4-3</p><p class="SimplePara">以 CSV 格式记录的数据文件</p>


<p>为了确保我们以 CSV 有效的方式构建我们的文件，当我们将每个记录写入文件时，我们将按如下方式进行:</p>
<ol><li class="ListItem"><p class="Para" id="Par43">在我们的文件中另起一行(或“新记录”)。</p>
 </li>
<li class="ListItem"><p class="Para" id="Par44">将温度值写入文件。</p>
 </li>
<li class="ListItem"><p class="Para" id="Par45">在文件中写一个逗号。</p>
 </li>
<li class="ListItem"><p class="Para" id="Par46">将压力写入文件。</p>
 </li>
<li class="ListItem"><p class="Para" id="Par47">写一个行尾字符。</p>
 </li>
</ol>

<p>如果我们遵循这个过程，当我们在文本编辑器中打开我们的 csv 文件时，它将看起来像是<strong class="EmphasisTypeBold ">图</strong> <a href="#Fig4"> <strong class="EmphasisTypeBold "> 4-4 </strong> </a>。</p>
<p><img alt="../images/486852_1_En_4_Chapter/486852_1_En_4_Fig4_HTML.jpg" src="../images/486852_1_En_4_Chapter/486852_1_En_4_Fig4_HTML.jpg" style="width:15.02em"/></p>
<p>图 4-4</p><p class="SimplePara">在文本编辑器中查看以 CSV 格式保存的数据</p>


<p class="Para" id="Par49">使用 micro:bit 文件系统给我们带来了另一个挑战。随着越来越多的数据被<strong class="EmphasisTypeBold ">写入</strong>(或者<strong class="EmphasisTypeBold ">附加</strong>)到一个文件中，最终 micro:bit 将无法再向其写入任何数据:将达到文件大小的上限。尽管 micro:bit 为文件存储保留了大约<strong class="EmphasisTypeBold "> 30 KB </strong>的内存，但它无法按照我们想要的方式写入那么大的文件。其他因素，例如微比特的工作记忆，也是限制因素。</p>
<p class="Para" id="Par50">micro:bit 文件系统的工作方式是，当你向一个文件中写入任何内容时，你就覆盖了该文件中已经存在的所有内容。这意味着当我们想要向一个文件追加更多的数据时，我们必须将文件中已经存在的所有数据读入一个变量，然后将我们想要追加的额外数据添加到变量中。然后，我们将添加了新记录的文件的全部内容写回到文件中。将数据写入文件时，最常见的限制因素是 micro:bit 将文件的全部内容存储到单个变量中的能力。</p>

<h2 class="Heading">4.7 测量我们可以存储多少数据点</h2>
<p>我们的实验设计表明，我们应该<strong class="EmphasisTypeBold ">“尽可能多地收集温度和压力数据”</strong>。知道我们在一个微比特上可以存储多少数据是有帮助的:</p>
<ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par52">如果我们可以在我们的 micro:bit 上存储 100 个数据点，这意味着我们应该在 24 小时内大约每 14 分半钟读取一次数据。</p></li>
<li><p class="Para" id="Par53">如果我们可以在我们的 micro:bit 上存储 1000 个数据点，这意味着我们可以大约每 90 秒读取一次数据。</p></li>
<li><p class="Para" id="Par54">如果我们可以在我们的 micro:bit 上存储 10，000 个数据点，这意味着我们大约每 9 秒钟可以读取一次数据。</p></li>
</ul>

<p class="Para" id="Par55">为了找出 micro:bit 的容量，我们将编写代码，用数据轰炸它，直到它崩溃，然后我们将看到在它停止工作之前我们设法保存了多少数据。好玩！别担心，微:位会没事的。</p>
<p class="Para" id="Par56">我们将编写一个程序，它可以非常快速地填满一个文件——只需几秒钟，而不是 24 小时。我们将对 micro:bit 进行编程，以从 SW01 读取温度和压力数据，并将其写入 CSV 文件，直到它无法再读取数据为止。</p>
<p><strong class="EmphasisTypeBold ">表</strong><a href="#Tab7">T5】4-7</a>中的<strong class="EmphasisTypeBold ">自然语言代码</strong>显示了我们需要告诉 micro:bit 要遵循的步骤。</p>
<p>表 4-7</p><p class="SimplePara">用于测量数据点的自然语言代码</p>


<table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="tcol1 align-left"/>
<col class="tcol2 align-left"/>
<col class="tcol3 align-left"/>
</colgroup>
<thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">步骤</p>
</th>
<th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">自然语言代码</p>
</th>
<th style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">笔记</p>
</th>
</tr>
</thead>
<tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">one</p>
</td>
<td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">导入任何所需的库。</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">我们需要核心 micro:bit 库以及天气传感器库。</p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Two</p>
</td>
<td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">初始化我们的气象站。</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">micro:bit 的大部分传感器和附件在使用前都需要进行“初始化”。</p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">three</p>
</td>
<td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">如果微:位存储器中已经有数据文件，则停止。</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">如果 micro:bit 中已经有数据文件，在 micro:bit 上显示“x ”,然后退出代码。否则继续执行代码。</p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">four</p>
</td>
<td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">创建一个文件并打开它进行写入。</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">这是我们写入数据的文件。</p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">five</p>
</td>
<td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">不断重复以下步骤。</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">我们将继续读写数据，直到程序崩溃！</p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">six</p>
</td>
<td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">将文件内容读入变量。</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">我们不能只是向文件中添加数据——当我们向文件中写入任何内容时，都会覆盖文件中已经存在的内容。所以我们需要首先将文件的现有内容复制到一个变量中。</p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">seven</p>
</td>
<td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">读取天气传感器的温度和湿度。</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">我们将向变量添加(“追加”)以下内容:</p>
<p class="SimplePara"><strong class="EmphasisTypeBold ">温度、湿度【新行字符】</strong></p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; text-align: left;"><p class="SimplePara">eight</p>
</td>
<td style="border-right: 0.5pt solid ; text-align: left;"><p class="SimplePara">将变量的内容写回文件。</p>
</td>
<td style="text-align: left;"><p class="SimplePara">这将把变量的内容写入永久内存，覆盖现有文件。</p>
</td>
</tr>
</tbody>
</table>

<p class="Para" id="Par58"><strong class="EmphasisTypeBold ">无代码选项</strong>:你可以在我们的<strong class="EmphasisTypeBold ">资源网站</strong>上找到这里使用的预编译代码的完整工作版本。转到<a href="https://nam12.safelinks.protection.outlook.com/?url%253Dhttp%253A%252F%252Fxib.one%252FXB%2526data%253D02%257C01%257C%257C96ee9c32c458423e9b6a08d7c36cd73f%257C84df9e7fe9f640afb435aaaaaaaaaaaa%257C1%257C0%257C637192744542720716%2526sdata%253D0W1OfWTmIx3U20MIwolvjFvh9lCQJVpw9KNNvUwCdU8%253D%2526reserved%253D0"> <code>http://xib.one/XB</code> </a>并搜索<strong class="EmphasisTypeBold ">第 4.7 节</strong>。</p>
Note
<p class="Para FirstParaInFormalPara" id="Par59">这段代码需要 SW01 MicroPython 库才能运行。请遵循以下步骤:</p>
<p>
 
</p>
<ol><li class="ListItem"><p class="Para ParaTypeImportant" id="Par61">下载 SW01 库(参见参考资料网站)。</p>
 </li>
<li class="ListItem"><p class="Para ParaTypeImportant" id="Par62">将预编译代码闪存到 micro:bit 上。</p>
 </li>
<li class="ListItem"><p class="Para ParaTypeImportant" id="Par63">将 SW01 库复制到 micro:bit 上。</p>
 </li>
</ol>


Warning
<p class="Para FirstParaInFormalPara">确保您按照列出的顺序执行这些步骤。</p>

<p><strong class="EmphasisTypeBold ">表</strong> <a href="#Tab8"> <strong class="EmphasisTypeBold "> 4-8 </strong> </a>展示了如何将<strong class="EmphasisTypeBold ">自然语言代码</strong>转换成<strong class="EmphasisTypeBold "> MicroPython </strong>代码，这些代码可以被编译并加载到您的 micro:bit 上。</p>
<p>表 4-8</p><p class="SimplePara">用 MicroPython 开发代码</p>


<table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col class="tcol1 align-left"/>
<col class="tcol2 align-left"/>
</colgroup>
<thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">步骤</p>
</th>
<th style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">描述</p>
</th>
</tr>
</thead>
<tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">one</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">键入以下内容:</p>
<p class="SimplePara"><code>from microbit import *</code></p>
<p class="SimplePara"><code>from SW01 import SW01</code></p>
<p class="SimplePara"><code>import os</code></p>
<p class="SimplePara"><code>import sys</code></p>
<p class="SimplePara">这将把所有需要的库导入到你的程序中。</p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">Two</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara"><code>SW01 = SW01()</code></p>
<p class="SimplePara">这将初始化(或“实例化”)SW01 库。</p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">three</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara"><code>d = 0</code></p>
<p class="SimplePara"><code>try:</code></p>
<p class="SimplePara"><code>d = os.size("we.csv")</code></p>
<p class="SimplePara"><code>except:</code></p>
<p class="SimplePara"><code>pass</code></p>
<p class="SimplePara"><code>if (d &gt; 0):</code></p>
<p class="SimplePara"><code>display.show("*")</code></p>
<p class="SimplePara"><code>sys.exit()</code></p>
<p class="SimplePara">当 micro:bit 加电时，如果已经有一个名为“we.csv”的文件，那么屏幕上会显示一个“<strong class="EmphasisTypeBold "> x </strong>”，程序将停止运行。这确保我们在尝试检索文件时不会覆盖它。</p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">four</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara"><code>open("we.csv", "w")</code></p>
<p class="SimplePara">这将创建名为<strong class="EmphasisTypeBold "> we.csv </strong>的文件，并打开它进行写入。</p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">five</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara"><code>while True:</code></p>
<p class="SimplePara">这是一个循环(就像 MakeCode 中的 forever 块):它将一直运行，直到 micro:bit 断电，或者出现错误(在我们的程序中，它将一直运行，直到数据文件变得太大并导致 micro:bit 抛出错误)。</p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara">six</p>
</td>
<td style="border-bottom: 0.5pt solid ; text-align: left;"><p class="SimplePara"><code>try:</code></p>
<p class="SimplePara"><code>with open("we.csv") as a:</code></p>
<p class="SimplePara"><code>cont = a.read()</code></p>
<p class="SimplePara"><code>cont = cont + str(SW01.getTempC()) + "," + str(SW01.getHumidity()) + "\n"</code></p>
<p class="SimplePara"><code>except:</code></p>
<p class="SimplePara"><code>display.show(".")</code></p>
<p class="SimplePara"><code>sys.exit()</code></p>
<p class="SimplePara">这将执行以下操作:</p>
<p class="SimplePara">打开文件进行阅读。</p>
<p class="SimplePara">将文件内容复制到变量中(<strong class="EmphasisTypeBold "> cont </strong>)。</p>
<p class="SimplePara">从天气传感器读取温度和湿度。</p>
<p class="SimplePara">将它们作为记录附加到内容的末尾。</p>
<p class="SimplePara">当存储器在写入过程中变满时，LED 矩阵上将显示<strong class="EmphasisTypeBold ">完全停止</strong>，程序将终止。</p>
</td>
</tr>
<tr><td style="border-right: 0.5pt solid ; text-align: left;"><p class="SimplePara">seven</p>
</td>
<td style="text-align: left;"><p class="SimplePara"><code>with open("we.csv", 'w') as b:</code></p>
<p class="SimplePara"><code>b.write(cont)</code></p>
<p class="SimplePara">这将把变量<strong class="EmphasisTypeBold "> cont </strong>的内容写入文件。</p>
</td>
</tr>
</tbody>
</table>

<p>完整的<strong class="EmphasisTypeBold "> MicroPython </strong>代码清单如下:</p>
<pre>from microbit import *
    from SW01 import SW01
    import os
    import sys

    SW01 = SW01()

    d = 0
    try:
        d = os.size("we.csv")
        except:
        pass




    if (d &gt; 0):
        display.show("*")
        sys.exit()

    open("we.csv",'w')

    while True:

        try:
            with open("we.csv") as a:
                cont = a.read()
                cont = cont + str(SW01.getTempC()) + "," + str(SW01.getHumidity()) + "\n"
        except:
            display.show(".")
            sys.exit()

        with open("we.csv", 'w') as b:
            b.write(cont)

</pre>
<p class="Para" id="Par68">当代码运行时，将在 micro:bit 上创建一个文件，并将一个新记录不断追加到文件的末尾。按照以下步骤查看在 micro:bit 停止之前写入了多少条记录:</p>
<p class="Para" id="Par69">将代码闪存到您的 micro:bit 中。<strong class="EmphasisTypeBold ">一旦刷新完成</strong>，代码将开始运行。</p>
<p>等待代码停止运行，如<strong class="EmphasisTypeBold ">图</strong> <a href="#Fig5"> <strong class="EmphasisTypeBold "> 4-5 </strong> </a>中的 LED 所示。</p>
<p><img alt="../images/486852_1_En_4_Chapter/486852_1_En_4_Fig5_HTML.jpg" src="../images/486852_1_En_4_Chapter/486852_1_En_4_Fig5_HTML.jpg" style="width:15em"/></p>
<p>图 4-5</p><p class="SimplePara">显示的 LED 亮起表示数据记录已经停止</p>


<p class="Para" id="Par71">提取文件并打开它，如前面所示。</p>
<p class="Para" id="Par72">滚动到文件末尾，检查写入了多少行—记下这个数字。</p>
<p class="Para" id="Par73">重复几次(首先从 micro:bit 存储器中删除数据文件，然后重启 micro:bit)。如果你有不止一个，你可以尝试不同的 micro:bits，或者让其他人也来尝试。这将因人而异，因时而异，但很可能你将能够存储 50 至 60 条记录。</p>
<p class="Para" id="Par74">我们发现可以相当可靠地存储 50 条记录。</p>
<p>再看一下我们在表<a href="#Tab8"> 4-8 </a>的步骤 3 中写的代码。该代码防止现有数据文件被添加或覆盖。如果您的 micro:bit 显示一个小的<strong class="EmphasisTypeBold ">【x】，</strong>表示这个<strong class="EmphasisTypeBold ">【软件锁】</strong>代码被激活，并且在 micro:bit 上检测到一个现有的数据文件(<strong class="EmphasisTypeBold ">图</strong> <a href="#Fig6"> <strong class="EmphasisTypeBold "> 4-6 </strong> </a>)。您需要从 micro:bit 文件系统中删除该文件才能继续。</p>
<p><img alt="../images/486852_1_En_4_Chapter/486852_1_En_4_Fig6_HTML.jpg" src="../images/486852_1_En_4_Chapter/486852_1_En_4_Fig6_HTML.jpg" style="width:15em"/></p>
<p>图 4-6</p><p class="SimplePara">小 x 表示数据文件已经在文件系统中</p>


EASY INFO CODES
<p class="Para FirstParaInFormalPara" id="Par76">x =数据文件已经在存储器中。没有数据记录发生。</p>
<p class="Para" id="Par77">。=数据记录完成。从存储器中提取数据文件。</p>


<h2 class="Heading">4.8 使用文件存储复制气象站实验</h2>
<p>我们现在已经拥有了建立一个能记录 24 小时数据的气象站所需的所有信息和技术。我们只需要选择记录数据的时间间隔，我们对 micro:bit 容量的理解就派上了用场:</p>
<ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par79">我们希望能够获得 50 个读数。</p></li>
<li><p class="Para" id="Par80">在 24 小时内，有 86400 秒。</p></li>
<li><p class="Para" id="Par81">我们将每 1728 秒读取一次读数，即每 28.5 分钟读取一次。</p></li>
</ul>

<p class="Para" id="Par82">代码和我们在<strong class="EmphasisTypeBold ">章节 4.7 </strong> ( <strong class="EmphasisTypeBold ">表</strong><a href="#Tab8">T5】4-8</a>)中写的测试文件存储大小容量的代码几乎一模一样。下面的代码清单突出显示了不同之处。</p>
<p class="Para" id="Par83">主要的区别在于，在我们之前编写的代码中，我们不想在写入文件之间等待；现在我们需要在读数之间加上一个长时间的延迟。我们还在代码中添加了一个简单的特性，以防止数据捕获自动开始。现在你的气象站开始捕捉数据<em class="EmphasisTypeItalic ">只有</em>如果你<strong class="EmphasisTypeBold ">按下微型按钮上的按钮 A </strong>。</p>
<p>完整代码如下所示，可在资源网站上找到:</p>
<pre>from microbit import *
from SW01 import SW01
import os
import sys

SW01 = SW01()
d = 0
try:
    d = os.size("we.csv")
except:
    pass

if (d &gt; 0):
    display.show("*")
    sys.exit()

bp = False

while True:

    if button_a.was_pressed():
        a = open("we.csv", "w")
        bp = True

    if (bp == True):
        try:
            with open("we.csv") as a:
                cont = a.read()
                cont = cont + str(SW01.getTempC()) + "," + str(SW01.getHumidity()) + "\n"
        except:
            pass
            display.show(".")

        with open("we.csv", 'w') as b:
            b.write(cont)

        sleep(1440000)    # Every 28.5 minutes

</pre>
<p class="Para" id="Par85">当这段代码运行时，在 micro:bit 上创建一个文件。每 28.5 分钟对气象传感器数据进行一次采样，采样值保存在文件中。如果内存缓冲区或存储器已满，程序将停止工作。</p>
<p>以下步骤说明了如何使用气象站作为便携式工具来获取远程位置的气象数据:</p>
<ol><li class="ListItem"><p class="Para" id="Par87">把 micro:bit 连接到你的电脑上，把代码闪到上面。</p>
 </li>
<li class="ListItem"><p class="Para" id="Par88">从计算机中取出 micro:bit 并连接便携式电池电源。</p>
 </li>
<li class="ListItem"><p class="Para" id="Par89">将 micro:bit 放在您想要捕获天气数据的位置。</p>
 </li>
<li class="ListItem"><p class="Para" id="Par90">按下按钮 A 开始拍摄。</p>
 </li>
<li class="ListItem"><p class="Para" id="Par91">当 micro:位停止时(存储空间已满)，5x5 矩阵上的 LED 会亮起。</p>
 </li>
<li class="ListItem"><p class="Para" id="Par92">使用 micro USB 电缆将 micro:bit 连接到计算机，并按照前面的说明提取文件。</p>
 </li>
</ol>

Note
<p class="Para FirstParaInFormalPara" id="Par93">这段代码被设计得尽可能简单。它可以通过多种方式进行改进，例如添加更多的错误处理，并在 micro:bit led 上提供关于程序状态的反馈。</p>


<h2 class="Heading">4.9 解决内存限制</h2>
<p>了解了微比特文件存储的局限性，我们就可以相应地进行实验。我们可以采用一些策略来确保充分利用可用空间:</p>
<ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par95">仅捕获需要的数据。如果您在下午 1 点开始一个实验，每 5 分钟读取一次传感器读数，则不需要在每次读取传感器读数时记录时间。</p></li>
<li><p class="Para" id="Par96">你可以试着写几个文件，也许在一个文件中写 40 条记录，然后在错误发生之前开始另一个。</p></li>
<li><p class="Para" id="Par97">尝试将温度数据写入一个文件，将压力数据写入另一个文件。</p></li>
<li><p class="Para" id="Par98">将数据存储在 SD 卡上。它可以保存比 micro:bit 更多的数据，并且当您将新程序刷新到 micro:bit 时，SD 卡上的数据不会被擦除。</p></li>
<li><p class="Para" id="Par99">更频繁地将数据从 micro:bit 转移到计算机中——我们早先的计划涉及每 24 小时从 micro:bit 中移除数据，但是如果我们可以在读取数据时从 micro:bit 中无线传输数据，那么 micro:bit 的存储容量将完全不会限制我们。</p></li>
</ul>

<p>还有其他方法来优化微:位持久性存储，以存储更多的数据点。</p>
<ul class="UnorderedListMarkBullet"><li><p class="Para" id="Par101">使用传感器数据文件的短名称(例如，使用<strong class="EmphasisTypeBold "> we.csv </strong>而不是<strong class="EmphasisTypeBold "> weather.csv </strong>)。</p></li>
<li><p class="Para" id="Par102">避免使用在 5X5 LED 矩阵上显示文本和图像的功能(例如，display.scroll()和 display.show())。</p></li>
<li><p class="Para" id="Par103">避免使用额外的库(例如，用于有机发光二极管显示的库)。</p></li>
</ul>


<h2 class="Heading">4.10 扩展数据存储容量</h2>
<p class="Para" id="Par104">我们将在下一章对 50 点数据集进行分析，这对于现在来说已经足够了。但这真的不是很多数据:一天有 86，400 秒，那么我们为什么要满足于只有 50 个数据点呢？</p>
<p class="Para" id="Par105">一个解决办法是查看 micro:bit 插件，看看是否有提供扩展内存选项的插件。有几个产品可用:SparkFun 和 XinaBox 提供外设，旨在通过将数据记录到 microSD 卡来扩展 micro:bit 的数据记录功能。如果您有 XinaBox IM01 micro:bit bridge，您会注意到背面有一个 microSD 卡插槽。</p>

<h2 class="Heading">4.11 摘要</h2>
<p class="Para" id="Par106">在本章中，我们学习了如何使用 micro:bit 文件系统在记录数据时存储数据，并在以后检索数据，从而消除了人工参与收集过程的需要。我们记录了一组 24 小时内的天气数据，这些数据存储在一个文件中，我们已经将它转移到一台笔记本电脑上。</p>
<p class="Para" id="Par107">我们现在将使用我们在本章中收集的数据进行一些更详细的分析，这是第<strong class="EmphasisTypeBold ">章</strong> <a href="05.html"> <strong class="EmphasisTypeBold "> 5 </strong> </a>的重点。</p>



</body>
</html>