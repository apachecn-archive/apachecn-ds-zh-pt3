

# 三、使用 Anaconda 发行版管理软件包

如果软件包是工具，那么软件包管理器就是。软件包管理器可以让你快速有效地找到你需要的软件包，并确保每个工具之间的无缝协作。它是能够清理数据、构建模型和创建功能软件的关键。

在这一章中，我们将深入了解这些包是什么，它们在哪里，以及如何使用 conda 和 Anaconda 工具将它们合并到您的项目中。了解如何获取您需要的包将是任何数据科学项目的第一步，因此您能够轻松做到这一点至关重要。

我们还将创建两个 conda 环境，看看您如何利用它们来创建可重复的项目，与您的同事共享它们，或者只为自己保留它们。

最后，您将发现一些更高级的 conda 特性，比如设置您的`.condarc`配置文件，这将使您能够更好地控制您想要做的事情。

在本章中，我们将讨论以下主题:

*   了解依赖关系解析的工作原理
*   发现什么是 conda 环境以及如何使用它们
*   使用 Anaconda Navigator 和 conda 管理频道
*   使用高级`conda`和`info`设置
*   康达备忘单

我们开始吧！

# 技术要求

要成功执行本章中的说明，请确保安装了 Anaconda 个人版。这包括康达和领航员。这个可以在这里下载:[https://www.anaconda.com/products/individual](https://www.anaconda.com/products/individual)。

包含本章中讨论的 conda 环境的配置信息的文件可以在 GitHub 存储库中找到:[https://GitHub . com/packt publishing/Building-Data-Science-Solutions-with-Anaconda/tree/main/chapter 03](https://github.com/PacktPublishing/Building-Data-Science-Solutions-with-Anaconda/tree/main/Chapter03)。

# 了解依赖关系解析的工作原理

依赖是软件开发和数据科学的基础部分。回到 [*第 1 章*](B16589_01_ePub.xhtml#_idTextAnchor015) ，*理解 AI/ML 的前景*，我们通过一个烹饪示例概述了制作某道菜所需的东西之间的依赖关系，以及这些需求如何相互冲突，从而导致一种棘手的情况。我们可以提供另一个食物类比，但是让我们给出一些更真实的东西来理解——为什么不使用其他任何人的包和库的替代方案会是一个挑战。

让我们来看一看，我们是否可以在没有任何依赖的情况下构建一个简单的 web 应用程序，让用户可以创建帐户并选择他们最喜欢的电影，以便您可以推荐他们可能喜欢的电影:

1.  首先，您需要为您的项目获得某种形式的认证。您将需要提高您的安全技能，如播种、散列函数、跨站点脚本和 SQL 注入，因为您不想在那里出现任何问题。
2.  你会希望能够看到这一点，所以你也需要创建一些前端库，使事情好看。
3.  还将有后端工作来创建存储和检索电影的逻辑，以及存储所有信息的数据库或工具。
4.  然后，您将需要构建一个日志框架，以确保您可以推断出代码中可能出现的任何问题。
5.  然后，您可能希望构建一个数据结构处理库，以便在处理数组和张量时，它们非常快。
6.  最后，您需要从头开始构建您的训练算法，并能够使它们具有足够的可扩展性和灵活性，以便能够随着您的需求变化而变化。

你可以做所有这些(甚至更多)，但也许你只是想利用其他已经满足这一需求的库或工具？您需要的组件的主要构件已经存在，可以让您更快地实现真正的目标。这是 99%以上的数据科学家和软件工程师都会走的路。让其他人专注于此，这样你就可以专注于你擅长的事情。

在依赖的世界里，拥有一个好的包管理器是关键。在下一节中，我们将比较在使用 Python 时最流行的两个，这将帮助您跟踪您可能想要使用的所有库和包，并解决任何潜在的冲突

## pip 和 conda 有什么不同

`pip`是 Python 自带的默认包管理器。它执行与 conda 相似的基本功能，即它将安装您指定的所需软件包。然而，与 conda 相比，在依赖冲突方面有一个巨大的不同。`pip`当您导入某些内容时，不会尝试修复任何不兼容版本的软件包问题。这会造成可怕的依赖地狱状态。**依赖地狱**是一种状态，在这种状态下，循环依赖创建了一种状态，在这种状态下，至少有两个依赖拥有它们所需要的相互冲突的东西。这可能是一个非常费时的情况下摆脱出来。

让我们看一个简单的例子。在下图中，您可以看到您的项目使用了两个库。**库 A** 需要`numpy`和`pandas`，库 B 也需要`pandas`。

![Figure 3.1 – Transitive dependency conflicts
](image/Figure_3.1.jpg)

图 3.1–传递性依赖冲突

由于传递性依赖关系，当您自己的项目中有多个依赖关系时，这种情况非常常见。一个**传递依赖**是你直接使用的一个包所需要的依赖。在上图中，您可以看到问题的出现是因为**库 B** 只与`pandas` **0.22.0** 兼容，但是**库 A** 需要一个仅在`pandas` **0.25.0** 中引入的`pandas`的新特性。在这个场景中，`numpy`和`pandas`是传递依赖关系。

在数学上，传递性可以概括为:如果 *A=B* 和 *B=C* ，那么 *A=C* 。在我们的意义上，如果*包 A* 需要*包 B* ，而*包 B* 需要*包 C* ，那么*包 A* 需要*包 C* 。

另一个例子是，`numpy`实际上并不依赖于任何其他 Python 包，因此它没有可传递的依赖关系。你会发现有些套餐是这样的。它们是在没有使用任何东西的情况下构建的，除了在那个包中创建的东西之外。一般来说，这种情况很少发生，但是没有任何理由让你或其他人利用其他包来做你需要做的事情。对于我们在本书中讨论的任务(创建模型和其他数据科学工作)，如果不导入包，您将很难完成您想要完成的任务。

你可以用`pip` 做一些事情，比如`pip-conflict-checker`([【https://github.com/ambitioninc/pip-conflict-checker】](https://github.com/ambitioninc/pip-conflict-checker))，它告诉你有一个问题，但不做任何事情。这不是很有帮助，但它迫使你找出解决它所揭示的问题的方法。

Conda 可以计算出需要哪些进口，因为它的主要组件之一是**解算器**。当你考虑使用它而不是`pip`时，这是要考虑的主要事情之一。conda solver 将根据您拥有的每个库和包的所有依赖关系来解决包的哪个版本导致冲突的问题。

在*图 3.1* 所示的早期示例中，conda 可以看到**库 A** 想要`pandas` **0.25.0** ，但实际上可以使用更低的版本，包括 0.22.0，这正是**库 B** 所期望的。这个一旦确定了，就用`pandas` **0.22.0** 了，大家都高兴。

康达解决方案

Conda 实际上内置了一些不同的解算器，但大多数都使用默认的。在 conda 的未来迭代中，它将允许任何人编写自己的求解器，只要它符合它提供的插件模式。这将允许一些人创造一些他们需要的东西。例如，解决问题的速度可能比确保收到最新的包裹更重要。你可以通过这里找到这个的最新状态:[https://github.com/conda/ceps/blob/main/cep-2.md](https://github.com/conda/ceps/blob/main/cep-2.md)。

另一个主要区别是**康达环境**。Conda 附带了一个虚拟包管理器，允许你根据你的项目需求建立离散环境。没有它，你将需要为 Python 使用诸如`pyvenv`(或现在的`venv`)之类的东西。

Conda 还允许你用 Python 之外的语言管理包。当你需要用 R 包或任何其他语言构建一些东西时，这就很方便了。

现在您已经知道了这两个工具的不同之处，让我们更深入地了解如何使用 conda 以及如何获得您需要的确切包。

# 发现什么是 conda 环境以及如何使用它们

在这一节中，您将学习如何使用 Anaconda 的一个关键特性,它允许您为代码创建单独的空间:环境。您将了解它们是什么，如何在 conda 和 Navigator 中创建它们，以及如何与他人共享这些环境。

首先，让我们确保您清楚地了解什么是环境，以及它们如何适应 conda 的其他部分。

康达有三个核心支柱，**环境**、**套餐**和**渠道**，了解每一个都是掌握康达的关键。我们已经在 [*第二章*](B16589_02_ePub.xhtml#_idTextAnchor036) 、*分析开源软件*中了解了软件包。在这里，我们将通过在杂货店购买食品的类比来了解环境和渠道。

三大支柱中的第一个是环境。用我们的食物类比，假设你正在做意大利面，甜点是核仁巧克力饼。你需要牛奶和鸡蛋来保持核仁巧克力饼的低温，所以你把它们放在冰箱里，但是西红柿和面条应该放在柜台上。

柜台和冰箱是独立的空间，或者说是独立的环境，取决于你所制作的东西的需求，这类似于康达环境将你的包裹分开。举一个真实世界的例子，一个环境可能包含 *Python 2.3* 和`numpy`，而另一个环境包含 *Python 3* 和`pandas`。

总之， **conda environments** 是包含软件包的隔离空间，它允许一个专用的容器来工作和安装软件包。

## 在康达创造环境

当您使用 conda 时，环境是您的操作基础。通常，建立一个环境是你开始一个项目时要做的第一件事，而激活它将是你开始一天的第一件事。让我们来看看如何设置和使用它。

康达可以做很多事情，但你会发现 80-20 法则适用于此。大约 20%的命令是您在 80%的时间里会用到的。环境中最常见的命令如下:

*   创建新的 conda 环境:

    ```
     conda create -n ENVIRONMENT
    ```

*   激活 conda 环境:

    ```
     conda activate ENVIRONMENT
    ```

*   停用当前 conda 环境:

    ```
     conda deactivate
    ```

*   将环境`yaml`文件导出到特定文件:

    ```
     conda env export --file FILENAME
    ```

当有疑问时，你可以用键入你想用的命令，然后用`--help`。例如，使用以下内容查看如何使用`conda create`的示例:

```
conda create –-help
```

命令行中的缩写

许多命令行工具都缩短了输入版本以减少输入，conda 也不例外。比如`--help`可以换成`–h`。大多数命令可以通过使用单个破折号和命令的第一个字母来缩短。您不必使用这些较短的版本，但是可以使用它们来创建更简洁的命令。使用`–h`将显示命令的所有选项，如`conda create –h.`

在本书中，我们将使用命令的缩写版本，除非我们引入了新的术语。

当你需要使用同一个库或应用程序的不同版本时，环境是很棒的，例如， *Python 2.7* 和 *3.7* 。

为了创建一个环境，使用与第 1 章 、*理解 AI/ML 环境*中相同的命令，但是在本章中使用了稍微不同的名称。让我们也添加一些额外的命令。创建一个名为`ch_3`的环境，然后使用以下命令安装`python 3.8`和`scikit-learn`:

```
conda create -n ch_3_env python=3.8  scikit-learn –y
```

让我们看看在前面的命令中使用的术语以及它们的用途:

*   这个命令告诉 conda 我们想要创建一个环境。
*   `-n`:`--name`命令的较短版本。这告诉 conda，下面这个词将是您希望环境命名的。
*   `ch_3_env`:该环境的名称。很重要的一点是，这可以是你选择的任何东西！环境名称有一些限制。例如，它不能包含以下字符:
    *   `/`'(正斜杠)
    *   ’(空格)
    *   `:`'(冒号)
    *   `#`'(数字、磅或散列)
*   这是我们希望我们的环境使用的 Python 版本。这是一个可选字段，如果您没有指定任何内容，那么 conda 将安装它所知道的最新版本。
*   `scikit-learn`:我们要安装的软件包的名称。在本例中，它是 scikit-learn，但是它可以是任意数量的包。
*   `–y`: Automatically accepts when conda asks whether you want to install the needed packages (shortened version of -`–yes`).

    Scikit-learn 还是 sklearn？

    你应该用哪一个？绝招问题，他们是一样的！安装`sklearn`实际上会给你最新版本的 scikit-learn，但是使用 conda 列表会显示`sklearn x.x`和 scikit-learn。使用`sklearn`没有任何优势，只会造成混乱，所以最好安装 scikit-learn，只要知道如果你看到有人使用术语`sklearn`，那真的只是 scikit-learn 躲在后面。

现在，让我们激活我们的环境，并列出安装在那里的软件包:

```
conda activate ch_3_env
conda list
```

您将看到 scikit-learn 与所有其他需要的包一起安装。Conda 自动计算出每个软件包的最新版本，这些版本可以下载而不会与其他已经存在的软件包冲突。

你可以用命令行做很多事情，但是也许你是一个想要更多视觉风格的人。Navigator 为您提供了这种选择。现在让我们来看一个类似的流程，除了 Navigator。

## 在导航器中创建环境

Anaconda Navigator 为那些不喜欢使用命令行的人提供了一个**图形用户界面** ( **GUI** )。conda 的许多功能都可以通过这种可视化的方式访问。我们开始吧！

1.  打开导航器。打开命令行，键入以下内容:

    ```
    anaconda-navigator
    ```

你也可以在你电脑上的其他应用程序旁边搜索**巨蟒导航** **(巨蟒 3)** 。

你将会看到 Anaconda 的标志，用户界面也会出现。您将看到一个可以直接从 UI 启动的应用程序列表，如下图所示。当我们创建模型时，我们将在后面的章节中更详细地讨论这些:

![Figure 3.2 – Anaconda Navigator: Main view
](image/Figure_3.2.jpg)

图 3.2-Anaconda 导航器:主视图

1.  创建您的环境:选择左上角的中的**环境**。注意这里列出了`ch_3_env`，可以在下面的截图中看到。如果选择它，您将看到与使用 conda `list`命令时相同的包。假设我们想要一个全新的环境，因为我们计划使用的东西不想要或不需要 *Python 3.8* ，而你认为旧版本支持得更好。

在列出的环境下，选择**创建**按钮。这样做会弹出一个窗口，您可以在其中指定想要创建的内容的详细信息。

![Figure 3.3 – Anaconda Navigator: The Create new environment button
](image/Figure_3.3.jpg)

图 3.3–Anaconda Navigator:创建新环境按钮

在**名称**字段中，输入`ch_3_env_nav`。在 **Python** 下拉列表中，选择 **3.7** 。最后，选择 **Create** 按钮，告诉 Navigator 我们已经准备好为我们创建这个环境。在短暂的间歇之后，您将会看到被安装到您的新`ch_3_env_nav`环境中的包。

我们现在可以看看如何在 Navigator 中安装软件包。

## 通过导航器安装软件包

所有这些背后的主要思想是安装包。以下步骤是如何在 Navigator 中完成的，稍后我们将了解 conda:

1.  安装您的包:我们稍后会想使用`pandas`来处理一些数据问题，所以让我们现在就在我们的新环境中安装它。在顶部，在您已安装的软件包上方，选择显示**已安装**的下拉菜单，并将其更改为**未安装**。这将改变过滤器，以显示任何没有安装。

现在，您将看到可以放入这个新环境中的所有可能的包。

1.  通过顶部的搜索框搜索`pandas`。然后，向下滚动，通过`pandas`选择复选框。最后，点击右下角的**应用**按钮。

![Figure 3.4 – Anaconda Navigator: Selecting a package to install
](image/Figure_3.4.jpg)

图 3.4-Anaconda Navigator:选择要安装的软件包

这样做将打开另一个窗口,要求您确认您理解将引入传递依赖关系。底部的一条消息将表明所有带*的包都是您想要的主包的依赖项。点击**应用**按钮，你会看到一个进度条，表明新的软件包正在你的本地系统上安装。

在 conda 上做这个看起来有点不一样。在下一节中，您将会看到不同之处。

## 通过 conda 安装软件包

正如你用命令行工具猜测的那样，在 conda 上安装包会有一点不同，但可以说更容易，这取决于你如何定义它。

要安装软件包，只需在终端中键入以下内容:

```
conda install pandas
```

这将为您提供将要安装的软件包的信息，然后询问您是否要继续:

```
Solving environment: done
[...]
Proceed ([y]/n)?
```

键入`y`并点击*回车*来安装这个:

```
Was this easier or better than Navigator? That is up to you to decide.
```

### 在康达和领航员之间抉择

您已经看到了两种轻松创建环境和下载包的方法。你更喜欢哪一个？没有错误的答案，事实上，你可以在你认为合适的时候来回切换，因为它们都反映了相同的变化。如果您现在在命令行中使用`conda env list`，您将看到您的新`ch_3_env_nav`环境被列出并准备好使用。

现在我们已经设置好了环境，我们需要一种方法来备份它们，并与同事、朋友和全世界共享它们。

## 向 Anconda.org 出口环境

OSS 和数据科学是一个共享者的社区，环境的好处之一是它们允许你成为这个社区的一部分。如果你做了一些伟大的研究，你可以与世界分享你的环境，这样人们就可以很容易地再造它。

例如，您可以假装希望让您的朋友 Emily 拥有与您完全相同的设置，这样她就可以运行您的项目并确保没有任何依赖问题。您可以使用 conda 的`export`命令创建一个文件，详细描述您拥有的确切环境，然后可以轻松地共享该文件。

要创建它，请回到您的终端并激活您的环境。一旦进入该环境，运行下面的命令以给定的`ch_3_env.yml`名称创建一个环境文件:

```
conda env export –-file ch_3_env.yml
```

我们现在可以打开文件，看看它的内容是什么。你可以使用任何你喜欢的文本编辑器。从记事本到谷歌文档的任何东西都可以工作，但是如果你想要快速简单的东西，你可以从命令行使用下面的:

```
vim ch_3 env_file
```

我们将看到该文件的内容，包括以下几个部分:

*   `name`–环境的名称
*   `channels`–conda 在哪里寻找包(稍后在*了解什么是渠道*一节中会有更多)
*   `dependencies`–环境中的包/库及其版本

这些部分是构成您的 conda 环境的主要方面，并将根据执行的其他操作自动更新。例如，如果您执行`conda install pandas`，那么您将看到这个文件中的依赖项被更新。你永远不需要手动更新这个文件，也不鼓励你直接编辑它。

### 分享 Anaconda.org 的环境

Anaconda.org 是一个由 Anaconda 运营的网站，拥有用户创建的频道和环境。如果你还没有账户，那就去那里注册一个免费的吧。

要从命令行执行某些操作，您需要安装`anaconda-client` **命令行界面** ( **CLI** ) 工具。幸运的是，这非常容易。您需要做的就是像安装其他软件包一样安装它，如下所示:

```
conda install anaconda-client
```

从现在开始，您可以在命令行中使用 Anaconda 来完成我们将要讨论的一些操作。

拥有帐户并安装 CLI 工具后，您可以使用以下部分中描述的任一步骤将您的环境上传到 Anaconda.org。

#### 从终端

打开一个终端，输入以下命令:

```
anaconda upload ch_3_env.yml
```

注意，默认情况下，`yaml`文件中指定的名称是上传时将使用的名称。

#### 将环境上传到 Anaconda.org

打开打开浏览器并导航至`https://anaconda.org/<username>/environment`。

在那里，使用**上传环境**按钮，然后通过弹出菜单在您的本地计算机上选择您的环境。确保使用您的用户名代替前面 URL 中的`<username>`。从现在开始，我们将此 URL 和页面称为您帐户的环境页面。

一旦你做了，你就会看到上传到同一个页面上的环境，现在准备好与全世界分享了。所有人需要做的就是导航到您的帐户环境页面，他们将能够看到并下载那个`yaml`文件。

### 下载共享环境

此时，任何人都可以下载并安装您的环境。就像上传环境一样，可以通过多种方式来完成。

#### 从 Anaconda.org 下载环境

让环境在线让我们能够下载您或其他人上传的环境。假设已经上传了环境，要下载和使用这些环境，只需执行以下步骤:

1.  转到`https://anaconda.org/<username>/environments`。
2.  选择所需的环境。
3.  进入**文件**选项卡，在**名称**字段下点击要下载的文件。您需要将它移动到您将要使用的目录中，以便于查找。
4.  从终端或 Anaconda 提示符，在命令行中输入以下命令:

    ```
    conda env create –n ex_env_name --file <path to env file>
    source activate ex_env_name _env
    ```

您也可以直接从终端或 Anaconda 提示符一步完成这项工作，而不必去 Anaconda.org。

1.  从终端或 Anaconda 提示符，在命令行中输入以下命令:

    ```
    conda env create <username>/ch_3_env
    source activate ch_3_env
    ```

Conda 假设您想从 Anaconda.org 获得一个环境。这将从该站点获取环境，并在安装到您的本地系统后激活它。

注意

确保总是相应地替换环境和用户的名称。

# 使用 Anaconda Navigator 和 conda 管理频道

是时候看看 Anaconda 景观的最后一个支柱了，那就是通道。在本节结束时，您将知道什么是通道以及如何指定它们，什么是`.condarc`文件以及如何设置它，以及如何获得您需要的确切的包版本。

这是一个预先警告您的快速注释，如果您正在获取更多的基本包，本节的一些内容可能不适用于您需要的内容。设置频道优先级之类的事情不是你必须要担心的，所以不要太担心知道这些事情的细节。然而，随着你的软件变得越来越复杂，它可能会非常有用。

让我们首先确定我们对什么是渠道有一个清楚的概念。

## 了解什么是渠道

渠道就是一个回购协议，其中包含一组由个人或公司创建的特定和有意的包。它允许您拥有一组工具，可以根据需要进行共享和提取。你可以把一个频道想象成电视频道。你知道，当你调到 ESPN 频道时，你会看到那个频道的所有节目。也许你总是在 ESPN 找到你的体育新闻，但是你去 ABC 新闻看你的国家新闻。

在这个类比中，节目类似于 conda 频道上提供的节目包。另一种思考方式是简单地把它看作传统文件系统中的一个文件夹。该文件夹中的任何包都是您可以下载和使用的。

默认通道是当你要求 conda 安装某些东西时，它将搜索要安装的包的起始位置。它是 Anaconda Inc .公司将它构建的包推送到的地方，因此是最可靠的。

### 默认频道

你可能会在帮助指南、官方文档以及诸如[https://repo.anaconda.com/pkgs/](https://repo.anaconda.com/pkgs/)等地方看到对`defaults`频道的引用。这其实是指 conda 默认搜索包的一组通道，因此得名。组成这个*默认*频道集合的频道如下:

*   `pkgs/main`
*   `pkgs/free`
*   `pkgs/r`
*   `pkgs/msys2`

您可以直接从前面列出的任何通道中提取软件包，但通常建议您只使用更高阶的`defaults`通道，并让 conda 在所有子通道中搜索您想要的软件包。

注意

Anaconda 通道只是`pkgs/main`通道的一个镜像(本质上是一个副本),所以您不需要两个都有。因为一个通道只是一个存放一定数量的包的位置，所以没有任何理由为什么你不能创建你自己的通道并拥有任何数量的其他通道的子集。

抚养一个孩子需要一个村庄，但维持一个包裹需要一个城市。我们的城市是以`conda-forge`的形式出现的。`conda-forge`是一项由社区驱动的工作，旨在构建可由 conda 包管理器无缝使用的包。这是为什么康达如此有价值的一个关键支柱，因为有数千种封装可供选择。

去[https://conda-forge.org/feedstock-outputs/](https://conda-forge.org/feedstock-outputs/)会给你一个`conda-forge`提供的列表，但是你也可以通过 conda 使用下面的命令搜索什么是可用的，包括`–c`参数，这是`--channel`的缩写:

```
conda search –c conda-forge
```

下面的示例展示了如何安装上一章的 SciPy，以及如何通过使用`--channel`来具体使用`conda-forge`通道(注意两个破折号):

```
$ conda install SciPy --channel conda-forge
```

如果您想将`conda-forge`添加到 conda 一直查看的一个通道中，那么您可以使用以下命令:

```
conda config --add channels conda-forge
```

Conda 会知道也要一直看着`conda-forge`。但是增加了多个渠道，同一个包可能在多个渠道，那么会先看哪里呢？在下一节中，我们将看到 conda 如何处理优先级，以及我们如何显式地设置通道优先级顺序。

## 设置频道优先级

将会有许多地方(或渠道)可以让你从中寻找打包产品。这些频道最常见的是`defaults`频道和`conda-forge`频道，但是你没有理由不能从 Anaconda.org 或任何其他地方指向你自己的频道。因此，同一个包可能有两个不同的版本，conda 需要知道应该选择哪一个。

Conda 将使用频道在设置文件中出现的顺序。`condarc` file)因为它是优先顺序的指南。有几种方法可以改变这种情况，我们现在就来介绍一下。

### 重新排序。condarc 文件

也许设置优先级最直接的方式是直接编辑文件本身。Conda 将尝试使用文件中列出的第一个通道，如果找不到，将使用列表中的下一个通道。

当您在命令行中键入`conda info`时，可以通过查看**用户配置文件**字段来找到`.condarc`文件。

您将在本章的【T1 使用高级 conda 信息和设置一节中找到关于`.condarc`文件的更多信息。

现在让我们看看您可能想要执行的两个操作——将通道添加到最高或最低优先级。

#### 以最高优先级顺序添加频道

使用终端，您可以告诉 conda 添加一个新通道，并将其放在`.condarc`文件的顶部，这意味着它将具有最高优先级，如下所示:

```
conda config --add channels new_channel
```

#### 以最低优先级顺序添加频道

使用下面的 conda 命令，您可以将通道放在`.condarc`文件的底部，这将告诉 conda 将其放在最低优先级，如下所示:

```
conda config --prepend channels new_channel
```

一个警告的话:即使你设置了这个，康达将忽略它，如果一些东西设置在一个更高的先例。详见本章后面的 *Conda 操作顺序*部分。还要注意的是，如果你只是使用`defaults`通道，你将永远不会有任何包碰撞和冲突，因为只有它们必需的版本。Anaconda 管理这些通道，允许这种好处。

接下来，我们将讨论如何告诉 conda 它不应该担心任何种类的包的优先级顺序。

### 不要在 conda 中使用优先频道

如果你不想让 conda 优先考虑任何特定的频道，你可以用`conda config --set channel_priority false`命令告诉它不要这样做。这将使 conda 只安装它能找到的最新版本的软件包。

您还可以告诉 conda 不要使用`.condarc`文件中的通道，方法是在安装软件包时，在命令行中与`--override-channels`命令一起传递一个要使用的通道。下面将在`conda-forge`频道中查找`pandas`，但不使用默认设置(这是您的`.condarc`文件要求查看的内容):

```
conda install –c conda-forge --override-channels pandas
```

这些是 conda 如何工作的基础，但是当你需要的时候，你可以做很多其他的事情来给你自己更多的控制。接下来，让我们看看如何做到这一点。

# 使用高级 conda 信息和设置

conda 有许多层，我们只是介绍了您将首先使用的层。还有许多其他的操作，你会发现非常有用，这反过来会使你工作起来更加容易。

让我们来看看如何找出 conda 在哪里寻找它的操作，并建立一个设置文件，以保持您在多个会话中使用 conda 的首选方式不变。

## 使用 conda info 查看配置信息

你会发现自己在排除故障，并且需要参考 conda 在哪里寻找某些设置，对于这一点，conda `info`已经涵盖了。

让我们在我们的`ch_3_env`环境中运行`conda info`，看看我们得到了什么。为了使代码更简洁，这里省略了一些输出:

```
conda info 
    active environment : base
    active env location : C:\Users\Dan\anaconda3
       user config file : C:\Users\Dan\.condarc
populated config files : C:\Users\Dan\.condarc
          conda version : 4.10.3         
python version : 3.8.8.final.0       base environment : C:\Users\Dan\anaconda3  (writable)           channel URLs :  https://repo.anaconda.com/pkgs/main/win-64
  https://repo.anaconda.com/pkgs/main/noarch
https://conda.anaconda.org/conda-forge/win-64
https://conda.anaconda.org/conda-forge/noarch               platform : win-64
```

注意

可能有些我展示的价值观你没有，反之亦然。这将基于您的特定安装位置、操作系统和特定版本的东西，如 Python。

以下是 conda 拥有的一些最重要的设置中最相关的键-值对。一些比较相关的例子如下:

*   你将有多个可以被激活的环境，但是在任何特定的时间只有一个可以被激活，就像你一次只能在一个文件夹中一样。这和你在使用`conda env list`的环境下观察*所看到的是一样的。
*   这些包含了 conda 知道的配置文件。如果您有一个特定于环境的`.condarc`文件，这将非常重要。如果你曾经忘记康达在哪里寻找这个，你已经找到了你的答案。

## 设置您的 conda 设置文件

我们已经介绍了很多命令，但是如果您想一次又一次地默认某些东西，该怎么办呢？将您的设置放在一个配置文件中是一个更好的主意，这样无论何时您需要它们，它们都在适当的位置。这将避免您需要多次输入相同的命令。Conda 的配置文件以`.condarc`文件的形式出现。

`.condarc`文件是 conda 搜索您的频道列表、频道优先级、是否需要设置代理服务器以及是否使用 SSL 加密的默认位置。

您可以在特定的`.condarc`文件所在的位置使用`conda info`命令，以及更多有用的信息。

您可能不希望所有环境都有一个单独的`.condarc`文件，这没关系。Conda 允许通过直接检查环境的根来决定需要做什么。当您在命令行中使用 conda 配置的`–env`选项时，这是 conda 放置配置的地方。

在您的`ch_3_env`环境中，使用以下命令:

```
conda config --env --add channels conda-forge
```

这将做两件事:

1.  在您的环境根目录下创建一个`.condarc`配置文件。
2.  将`conda-forge`通道添加到`.condarc`文件中。

如果您现在运行`conda list`，您将看到这个新的配置文件列在**填充的配置文件**部分下，它将包含以下内容:

```
channels:
  - conda-forge
  - defaults
```

这表示当你安装软件包时，首先检查`conda-forge`，然后检查`defaults`。

### 显示将用于下载带有 conda 列表的软件包的频道 URL

另一个有用的设置是在搜索和安装软件包时显示频道的 URL:

```
show_channel_urls: true
```

当你有很多你正在看的频道时，这可能是你需要的信息，以确保你保持你的方向。

说到保持你的方位，这是一件好事，知道康达如何在如此多的选项中保持自己的设置不变。让我们快速回顾一下，这样你就不会一头撞在墙上，试图找出为什么你的设置没有得到尊重。

### 康达操作顺序

Conda 有一个用于查找其配置的操作顺序，它将按照与处理通道类似的方式执行这些操作。如果它发现了什么，那么它会停下来，不用担心检查其他任何东西。顺序如下:

1.  有没有可以使用的环境变量？
2.  有命令行输入吗？
3.  我在环境根目录下的`.condarc`文件说了什么？
4.  我的`base.condarc`文件怎么说？

除了这里列出的最常用的选项之外，conda 还允许在`.condarc`文件中使用许多其他选项。要想了解完整的概要，可以查阅官方文档:[https://conda . io/projects/conda/en/latest/configuration . html](https://conda.io/projects/conda/en/latest/configuration.html)。

已经展示了相当多的命令，最好能有一个快速的参考。

# 康达备忘单

这里是你会发现自己经常使用的更常见的 conda 命令，以及一些额外的命令，通过快速参考，它们将被证明是方便的。

## 康达通用命令

一般命令如下:

*   `conda install <package>`:从您的频道中搜索并安装指定的软件包
*   `conda info`:显示康达的基本信息
*   `conda config --add channels conda-forge`:增加搜索包的频道
*   `conda update –all`:更新所有可以更新的包
*   `conda search <package>`:搜索适当的频道特定包
*   `conda create –-name <environment_name> python=<python version>`:创建一个新的 conda 环境，安装指定的 Python 版本
*   `conda activate <environment_name>`:激活允许您使用的指定 conda 环境

## Conda 环境命令

特定环境命令如下:

*   `conda create -n ENVIRONMENT`:创建新的康达环境
*   `conda activate ENVIRONMENT`:激活 conda 环境
*   `conda deactivate`:取消激活当前的 conda 环境
*   `conda env export --file FILENAME`:将环境的`yaml`文件导出到特定文件

这些只是可用命令中的一部分，但是您会发现自己会多次使用这些命令。如果你想要更完整的列表，可以在这里找到官方备忘单:[https://docs . conda . io/projects/conda/en/4 . 6 . 0/_ downloads/52a 95608 c 49671267 e 40 c 689 E0 BC 00 ca/conda-cheat sheet . pdf](https://docs.conda.io/projects/conda/en/4.6.0/_downloads/52a95608c49671267e40c689e0bc00ca/conda-cheatsheet.pdf)。

# 总结

到目前为止，您已经看到了如何使用 conda 的命令行创建环境，以及如何使用 Navigator 使用更加可视化的方法。您已经了解了依赖关系管理是什么样子的，以及为什么考虑不同的可传递依赖关系及其版本很重要。

您已经看到了上传和共享您的环境是多么容易和简单，这样其他人就可以从中受益。

此外，我们通过查看渠道以及 conda 如何利用许多不同的资源来获得所需的软件包，总结了 conda 的三大支柱。我们已经提到`conda-forge`是其中一个地点。

你在这一章中学到的很多东西将在你的日常工作中被证明是非常宝贵的，我鼓励你在这里参考 conda 备忘单，直到你不再需要它。你会经常用到一些命令，所以不会花很长时间。

现在我们已经很好地了解了 Anaconda 工具，在下一章中，让我们继续我们的旅程，了解并使用一些最流行的数据科学工具，包括 Jupyter 笔记本、`pandas`、`numpy`和可视化工具 Matplotlib。